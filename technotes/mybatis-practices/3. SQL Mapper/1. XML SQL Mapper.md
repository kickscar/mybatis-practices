1. XML SQL Mapper

## 매핑(Mapping)

 MyBatis는 SQL과 자바 객체와의 매핑에 주력한 ORM 기술로 SQL문의 파라미터와 Select의 결과(ResultSet)를 자바 객체에 매핑한다. 이 매핑 도구를 Mapper라 부르고 XML 또는 Mapper Interface의 Annotation을 통해 가능하다. 이 두가지 방법에 따라 각각 XML Mpper 또는 Annotation Mapper라 부른다. 개인적으로 XML Mapper를 선호하는 편이지만 Annotation Mapper의 Mpapper Interface는 매핑 방법에 상관없이 매핑된 SQL문 실행에 많은 유연성을 제공하기 때문에 알아 두는 것이 좋다. SQL문의 실행은 언급한 바, Mpapper Interface를 선호하지만 SqlSession 객체의 메소드 호출이 보다 일반적이라 볼 수 있다.
 여기서는 XML Mapper를 통한 다양한 매핑 방법을 먼저 알아보고 SQL문 실행을 앞에서 언급한 두 가지 방법으로 테스트해 볼 것이다. 그리고 Mapper Interface를 통한 Annotation Mapper 방법도 함께 살펴 본다.

## 매퍼 인터페이스(Mapper Interface)
 매핑 구문의 파라미터 매핑과 select 구문의 결과 매핑을 살펴보기 전에 매핑 구문의 실행 방법부터 알아보자. 예제 ex01은 2장 Mapper 설정에서 살펴 본 예제와 동일하다. SqlSession 객체 메소드 호출을 통한 방법이다.

\[예제: mybatis/config/ex01.xml\]

```xml
<configuration>
    <properties resource="properties/jdbc.properties" />

    <typeAliases>
        <typeAlias type="domain.Book" alias="book" />
    </typeAliases>

    <environments default="devel">
        <environment id="devel">
            <transactionManager type="JDBC" />
            <dataSource type="POOLED">
                <property name="driver" value="${jdbc.driverClassName}"/>
                <property name="url" value="${jdbc.url}"/>
                <property name="username" value="${jdbc.username}"/>
                <property name="password" value="${jdbc.password}"/>
            </dataSource>
        </environment>
    </environments>

    <mappers>
        <mapper resource="mybatis/mapper/ex01/book.xml" />
    </mappers>
</configuration>
```

\[예제: mybatis/mapper/ex01/book.xml\]

```xml
<mapper namespace="book">
    <insert id="insert" parameterType="string">
        insert into book values(null, #{name })
    </insert>
</mapper>
```

\[Test: mybatis/mapper/ex01/TestMapper.java\]

```java
public class TestMapper {

	@Test
    public void testInsert()  {
        SqlSession session = sqlSessionFactory.openSession();

        int count = session.insert("book.insert", "마이바티스 연습");

        assertEquals(1, count);
    }
}
```

 Mapper에 매핑한 insert 매핑 구문을 호출하기 위해 SqlSession 객체의 inseert 메소드를 호출하고 매핑된 구문의 "(namespace).(구문 ID)" 형식의 문자열과 매핑된 파라미터 타입의 객체를 메소드의 파라미터로 전달한다. 크게 문제될 것은 없지만 문자열 기반의 호출은 오타로 실행 타임시 에러를 발생할 가능성이 있다. 이를 해결할 수 있는 방법은 Mapper Interface를 사용하는 방법이다. 다음 예제 ex02를 살펴보자.  

\[예제: mybatis/config/ex02.xml\]

```xml
<configuration>
    <properties resource="properties/jdbc.properties" />

    <typeAliases>
        <typeAlias type="domain.Book" alias="book" />
    </typeAliases>

    <environments default="devel">
        <environment id="devel">
            <transactionManager type="JDBC" />
            <dataSource type="POOLED">
                <property name="driver" value="${jdbc.driverClassName}"/>
                <property name="url" value="${jdbc.url}"/>
                <property name="username" value="${jdbc.username}"/>
                <property name="password" value="${jdbc.password}"/>
            </dataSource>
        </environment>
    </environments>

    <mappers>
        <mapper resource="mybatis/mapper/ex02/book.xml"/>
    </mappers>
</configuration>
```
 SqlSessionFactory 설정은 예제 ex01과 큰 차이가 없다. Mapper 파일만 변경하였다.

\[예제: mybatis/mapper/ex02/book.xml\]

```xml
<mapper namespace="mybatis.mapper.ex02.Book">
    <insert id="insert" parameterType="string">
        insert into book values(null, #{name })
    </insert>
</mapper>
```

 구문 정의는 앞의 예제와 동일하지만 namespace가 패키지명을 포함한 Mapper Interface의 이름으로 변경되었다. 이제 Mapper Interface 정의를 살펴보자.

\[Test: mybatis/mapper/ex02/Book.java\]

```java
public interface Book {
    int insert(String name);
}
```

 Mapper Interface를 정의할 때는 Mapper 파일의 구문 아이디와 같은 메소드 이름, parameterType과 같은 메소드 파라미터 그리고 resultType과 동일한 리턴 타입의 메소드를 정의해야 한다. 이제 Mapper Interface를 사용한 매핑 구문 호출을 테스트해 보자.

\[Test: mybatis/mapper/ex02/TestMapper.java\]

```java
public class TestMapper {

    @Test
    public void testInsert()  {
        SqlSession session = sqlSessionFactory.openSession();

        Book book = session.getMapper(Book.class);
        int count = book.insert("마이바티스 연습");

        assertEquals(1, count);
    }
}
```

 결과는 같지만 호출 방식에서 차이가 있다. Mapper Interface 객체를 SqlSession로 부터 반환받아 인터페이스에 정의한 메소드로 매핑 구문을 호출한다. 주의할 것은 매핑 구문과 Mapper Interface의 메소드의 이름, 반환 타입, 파라미터가 일치하지 않으면 예외가 발생한다는 것이다. 한편, MyBatis는 Mapper Interface의 메소드 반환 타입 및 파라미터를 Reflection을 통해 알아낼 수 있기 때문에 매핑 구문에서 parameterType과 resultType의 생략이 가능하다. 하지만, 명시적으로 설정하는 것이 가독성과 유지보수 측면에서 좋다.

```xml
<mapper namespace="mybatis.mapper.ex02.Book">
    <insert id="insert">
        insert into book values(null, #{name })
    </insert>
</mapper>
```
 다음과 같이 생략해도 구문 실행에는 큰 문제가 없다.


## 매핑 구문(Mapped Statement)

### insert

### update

### delete

### select



## 결과 매핑(Result Mapping)

### One-to-One

### One-to-One with Nested ResultMap

### One-to-One with Nested Select

### One-to-Many

### One-to-Many with Nested ResultMap

### One-to-Many with Nested Select



## 동적 매핑(Dynamic Mapping)